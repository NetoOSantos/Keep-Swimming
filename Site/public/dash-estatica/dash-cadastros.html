<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keep Swimming | dash-Cadastro</title>

    <link rel="stylesheet" href="nav.css">
    <link rel="stylesheet" href="dash-cadastro.css">
    <!-- <link rel="stylesheet" href="../public/css/tela-cadastro.css"> -->

</head>

<body>

    <div class="header">
		<img src="./logo ppt2.png" alt="" height="60px">
	</div>

    <div class="corpoDebaixo">

        <div class="header"></div>

        <div id="sidebarMenu">
            <ul class="sidebarMenuInner">
                <li><b style="color:rgb(136, 136, 136)"> <img src="./dash.png" alt="" height="25px"> Dashboard</b></li>
                <li> <a href="graficos.html"><img src="./monitoramento.png" alt="" height="25px">Monitoramento</a></li>
                <li> <a href="dash-cadastros.html"><img src="./perfil.png" alt="" height="25px">Cadastrar Desenvolvedor</a></li>
                <li> <a href="https://app.pipefy.com/public/form/w7YSTr_A">
                        <img src="./suporte.png" alt="" height="25px"> Suporte</a></li>
                <li><a href="../index.html">
                        <div class="sair">
                            <img src="./logout 1.png" alt="" height="50px">
                        </div>
                    </a></li>
            </ul>
        </div>

        <div id='center' class="main ">

            <div class="baixo">



                <form id="form_cadastro">

                    <h3>Cadastre seus funcionarios</h3>

                    <div class="roles">

                        <div class="ladoEsquerdo">
                            <label for="username">Nome Funcionario</label>
                            <input type="text" name="nome_Funcionario" placeholder="Nome" id="username">

                            <label for="email">Email Funcionarios</label>
                            <input type="email" name="email_funcionario" placeholder="Email corparativo" id="email_funcionario">

                            <label for="username">Gestor Responsavel</label>
                            <input type="" name="Gestor" placeholder="Nome" id="nome_gestor">




                            <div class="div_botao">
                                <button class="btn efeito" type="button" onclick="cadastrarFuncionario()">Cadastrar</button>
                            </div>
                        </div>



                        <div class="ladodireito">
                            <label>Cargo</label>
                            <input type="" name="cargo" placeholder="Desenvolvedor Back-End" id="cargo">

                            <label for="password">Senha</label>
                            <input type="password" name="senha" placeholder="*******" id="senha">


                            <label for="password">Confirma Senha</label>
                            <input type="password" name="confirmacao-senha" placeholder="*******" id="confirmacao_senha">
                        </div>

                        <div class="cardErro" id="erro" style="display: none;"></div>

                    </div>
                </form>

                <div class="mural_funcionarios" id="mural">

                </div>


            </div>

        </div>


    </div>


    </div>

</body>

</html>

<script>
   

    function cadastrarFuncionario()
     {
      
        var idEmpresa = sessionStorage.getItem('ID_USUARIO');

         var nomeVar = username.value;
         var emailVar = email_funcionario.value;
         var gestorVar = nome_gestor.value;
         var cargoVar = cargo.value;
         var senhaVar = senha.value;
         var confirmacaoSenhaVar = confirmacao_senha.value;
 
         if (nomeVar == "" || emailVar == "" || gestorVar == "" || cargoVar == "" || senhaVar == "" || confirmacaoSenhaVar == "") {
            erro.style.display = "block"
            erro.innerHTML = "Preencha todos os campos para prosseguir!";

           // finalizarAguardar();
            return false;
        } else {
            setInterval(sumirMensagem, 5000)
        }

        if (emailVar.indexOf("@") == -1 || emailVar.indexOf(".com") == -1) {
            erro.style.display = "block"
            erro.innerHTML = "Ops, e-mail inv치lido! Verifique e tente novamente.";
           // finalizarAguardar();
            return false;
        } 

        if (senhaVar != confirmacaoSenhaVar) {
            erro.style.display = "block"
            erro.innerHTML = "As senhas inseridas devem ser iguais para prosseguir!";
            //finalizarAguardar();
            return false;
        } else {
            setInterval(sumirMensagem, 5000)
        }


        // Enviando o valor da nova input
        fetch("/usuarios/cadastrarFuncionario", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora v치 para o arquivo routes/usuario.js
                nomeServer: nomeVar,
                emailServer: emailVar,
                gestorServer: gestorVar,
                cargoServer: cargoVar,
                senhaServer: senhaVar,
                idEmpresa,
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                console.log('cadastro realizado com sucesso');
                limparFormulario();
               // finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
           // finalizarAguardar();
        });

        return false;

     }

     function sumirMensagem() {
        erro.style.display = "none"
    }

    function listar()
    {
        fetch("/usuarios/listar",{
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nomeServer: nomeVar,
                emailServer: emailVar,
                gestorServer: gestorVar,
                cargoServer: cargoVar
            })
        }).then(function(resposta) {
            console.log("resposta: ", resposta);

                if (resposta.ok) {
                    console.log('dados funcion치rio obtidos com sucesso');

                  /*  window.location = "./tela-login.html";
                    limparFormulario();
                    finalizarAguardar();*/
                } else {
                    throw ("Houve um erro ao tentar capturar os dados nos funcion치rios no banco!");
                }
                }).catch(function(resposta) {
                console.log(`#ERRO: ${resposta}`);
            //    finalizarAguardar();
                });

                return false;
    }

</script>