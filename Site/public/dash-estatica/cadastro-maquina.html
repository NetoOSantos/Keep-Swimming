<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keep Swimming | dash-Cadastro</title>

    <link rel="stylesheet" href="nav.css">
    <link rel="stylesheet" href="cad-maquina.css">
    <!-- <link rel="stylesheet" href="../public/css/tela-cadastro.css"> -->

</head>

<body>

    <div class="header">
		<img src="./logo ppt2.png" alt="" height="60px">
	</div>

    <div class="corpoDebaixo">

        <div class="header"></div>

        <div id="sidebarMenu">
            <ul class="sidebarMenuInner">
                <li> <a> <img src="./dash.png" alt="" height="25px"> Dashboard</a></li>
                <li> <a href="graficos.html"><img src="./monitoramento.png" alt="" height="25px">Monitoramento</a></li>
                <li> <a href="dash-cadastros.html"><img src="./perfil.png" alt="" height="25px">Cadastrar Desenvolvedor</a></li>
                <li> <a href="https://app.pipefy.com/public/form/w7YSTr_A">
                        <img src="./suporte.png" alt="" height="25px"> Suporte</a></li>
                <li><a href="../index.html">
                        <div class="sair">
                            <img src="./logout 1.png" alt="" height="50px">
                        </div>
                    </a></li>
            </ul>
        </div>

        <div id='center' class="main ">

            <div class="baixo">



                <form id="form_cadastro">

                    <h3>Cadastre sua Máquina</h3>

                    <div class="roles">

                        <div class="ladoEsquerdo">

                            <label for="hostName">HostName</label>
                            <input type="text" name="hostName" placeholder="Host name" id="host_name">
                            
                            <label for="idMaquina>ID Máquina</label>
                            <input type="text" name="idMaquina" placeholder="ID" id="id_maquina">

                            <label for="idFuncionario">ID Funcionário</label>
                            <input type="text" name="idFuncionario" placeholder="ID Funcionário" id="id_funcionario">

                            <label for="sistemaOperacional">Sistema Operacional</label>
                            <input type="text" name="sistemaOperacional" placeholder="Sistema Operacional" id="sistema_Operacional">

                            
                        </div>



                        <div class="ladodireito">
                         
                            <label for="arquitetura">Arquitetura</label>
                            <input type="" name="arquitetura" placeholder="32bits/64 bits" id="arquitetura_">

                            <label for="permissao">Permissão</label>
                            <input type="text" name="permissao" placeholder="true / false" id="permissao_">

                            <label for="fabricante">Fabricante</label>
                            <input type="text" name="fabricante" placeholder="GNU" id="fabricante_">

                          
                        </div>

                        <div class="cardErro" id="erro" style="display: none;"></div>

                    </div>
                    <div class="div_botao">
                        <button class="btn efeito" type="button" onclick="cadastrarMaquina()">Cadastrar</button>
                    </div>

                </form>

                <div class="mural-maquina">
                    <div class="conteiner">
                        <button href="#" class="list">Listar Máquinas</button>
                        <div class="card">
                            <div class="box">
                                <div class="conteudo">
                                    <h2>01</h2>
                                    <h3>Máquina 01</h3>
                                    <div class="alinhar">
                                        <input type="text" name="email_funcionario" placeholder="Numero da máquina" id="maquina">
                                        <button href="#" class="att">Atualizar</button>
                                        <button href="#" class="rmv">Remover</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="conteiner">
                        <div class="card">
                            <div class="box">
                                <div class="conteudo">
                                    <h2>02</h2>
                                    <h3>Máquina 02</h3>
                                    <div class="alinhar">
                                        <input type="text" name="email_funcionario" placeholder="Numero da máquina" id="maquina">
                                        <button href="#" class="att">Atualizar</button>
                                        <button href="#" class="rmv">Remover</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="conteiner">
                        <div class="card">
                            <div class="box">
                                <div class="conteudo">
                                    <h2>03</h2>
                                    <h3>Máquina 03</h3>
                                    <div class="alinhar">
                                        <input type="text" name="email_funcionario" placeholder="Numero da máquina" id="maquina">
                                        <button href="#" class="att">Atualizar</button>
                                        <button href="#" class="rmv">Remover</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="conteiner">
                        <div class="card">
                            <div class="box">
                                <div class="conteudo">
                                    <h2>04</h2>
                                    <h3>Máquina 04</h3>
                                    <div class="alinhar">
                                        <input type="text" name="email_funcionario" placeholder="Numero da máquina" id="maquina">
                                        <button href="#" class="att">Atualizar</button>
                                        <button href="#" class="rmv">Remover</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    

              
             
                </div>
                <!-- <div class="mural_funcionarios" id="mural">
                        
                    <button onclick="atualizarFeed()" class="btn_mural_funcionarios" id="btn_funcionarios">USUÁRIO CADASTRADOS</button>
                       <div id="feed_container" class="feed-container"></div>

                                    <button onclick="atualizarFeed()" style="display: none;" id="atualizar">Atualizar Feed</button>

                            <div class="botoes_crud">
                                    <button style="display: none;" id="btn_deletar" onclick="deletarUsuario()">Deletar usuário</button>   
                                    <button style="display: none;" id="btn_atualizar" onclick="updateUsuario()">Atualizar usuário</button>             
                            </div>

                            <input type = "number" placeholder="id do Funcionário" id="updateDelete" style="display: none;" class="inputDeleteUpdate">
                            
                            <select  id="atualizarOpcoes" style="display: none;">
                                <option value="">Atualizar:</option>
                                <option value="id">ID</option>
                                <option value="nome">Nome</option>
                                <option value="email">Email</option>
                                <option value="cargo">Cargo</option>
                            </select>

                            <input id="ipt_update" style="display: none;" class="ipt_update"> 

                            <div id="respostaDeleteUpdate"></div>

                      </div>


                 </div>
            </div>
        </div> -->


    </div>


    </div>

</body>

</html>

<script>
   
   var ultimoIdFuncionario = 0;

    function cadastrarMaquina()
     {
        
         var hostName = host_name.value        
         var idMaquina = id_maquina.value;
         var idFuncionario = id_funcionario.value
         var sistemaOperacional = sistema_Operacional.value;
         var arquitetura = arquitetura_.value;
         var permissao = permissao_.value;
         var fabricante = fabricante_.value
 
         if (hostName == ""||idMaquina == "" || idFuncionario == "" ||sistemaOperacional == "" || arquitetura == "" || permissao == "" || fabricante == "") {
            erro.style.display = "block"
            erro.innerHTML = "Preencha todos os campos para prosseguir!";

           // finalizarAguardar();
            return false;
        } else {
            setInterval(sumirMensagem, 5000)
        }

        if (arquitetura != 32 && arquitetura != 64) {
            erro.style.display = "block"
            erro.innerHTML = "Arquitetura inválida, preencha com um valor válido 32 ou 64 bits"
            
            return false;
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrarMaquina", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                idMaquinaServer: idMaquina,
                idFuncionarioServer: idFuncionario,
                sistemaOperacionalServer: sistemaOperacional,
                fabricanteServer: fabricante,
                arquiteturaServer: arquitetura,
                permissaoServer: permissao,
                hostNameServer: hostName,
              
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                alert("cadastro realizado com sucesso!");
                console.log('cadastro realizado com sucesso');
                //limparFormulario();
               // finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
           // finalizarAguardar();
        });

        return false;

     }

     function sumirMensagem() {
        erro.style.display = "none"
    }




    function atualizarFeed() {
        //aguardar();
        btn_funcionarios.style.display = 'none';
        atualizarOpcoes.style.display = 'none';
            ipt_update.style.display = 'none';
        btn_deletar.style.display = 'block';
        btn_atualizar.style.display = 'block';
        updateDelete.style.display = 'block';
        atualizar.style.display = 'block';
        respostaDeleteUpdate.innerHTML = "";
      
        fetch("/usuarios/listar").then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    feed.appendChild(mensagem);
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));

                    var feed = document.getElementById("feed_container");
                    feed.innerHTML = "";
                    for (var i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];

                        // criando e manipulando elementos do HTML via JavaScript
                        var divPublicacao = document.createElement("div");
                        var spanID = document.createElement("span");
                     //   var spanGestor = document.createElement("span");
                        var spanNome = document.createElement("span");
                        var spanEmail = document.createElement("span");
                        var spanCargo = document.createElement("span");
                       // var divDescricao = document.createElement("div");
                      //  var divButtons = document.createElement("div");

                        spanID.innerHTML = "ID: <b>" + publicacao.idFuncionario + "</b>";
                       // spanGestor.innerHTML = "Gestor: <b>"+ publicacao.fkGestor + "</b>";
                        spanNome.innerHTML = "Nome: <b>"+publicacao.Nome+"</b>";
                        spanEmail.innerHTML = "Email: <b>" + publicacao.EMAIL + "</b>";
                        spanCargo.innerHTML = "Cargo: <b>" + publicacao.Cargo + "</b>";
                        //divDescricao.innerHTML = "Descrição: <b>"+publicacao.descricao+"</b>";

                        divPublicacao.className = "publicacao";
                       // spanTitulo.id = "inputNumero"+publicacao.idAviso;
                        spanID.className = "id-funcionario";
                     //   spanGestor.className = "Gestor";
                        spanNome.className = "nome";
                        spanEmail.className = "Email";
                        spanCargo.className = "cargo";
                       // spanTitulo.className = "publicacao-titulo";
                       // divDescricao.className = "publicacao-descricao";

                       // divButtons.className = "div-buttons"

                        divPublicacao.appendChild(spanID);
                       // divPublicacao.appendChild(spanGestor);
                        divPublicacao.appendChild(spanNome);
                        divPublicacao.appendChild(spanEmail);
                        divPublicacao.appendChild(spanCargo);
                       // divPublicacao.appendChild(spanTitulo);
                       // divPublicacao.appendChild(divDescricao);
                      //  divPublicacao.appendChild(divButtons);
                        feed.appendChild(divPublicacao);

                        ultimoIdFuncionario = publicacao.idFuncionario;
                    }

                   // finalizarAguardar();
                });
            } else {
                throw('Houve um erro na API!');
            }
        }).catch(function(resposta) {
            console.error(resposta);
            //finalizarAguardar();
        });
    }

    function deletarUsuario(){
        var idFuncionario = updateDelete.value;
        respostaDeleteUpdate.innerHTML = "";
        ipt_update.style.display = 'block';

        if(idFuncionario == ''  )
        {
            alert("id vazio");
        }
        else if(ultimoIdFuncionario  < idFuncionario)
        {
            alert("Digite um id válido");
        }
        else{

        fetch("/usuarios/deletarFuncionario", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                
                idDelete: idFuncionario,
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                console.log('delete realizado com sucesso');
                respostaDeleteUpdate.innerHTML = "Delete realizado com sucesso";
                limparFormulario();
               // finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o delete!");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
           // finalizarAguardar();
        });
    }

        return false;
    }

    function updateUsuario(){
        var idFuncionario = updateDelete.value;
        var alteracaoFuncionario = ipt_update.value;
        var select_update = atualizarOpcoes.value;
        respostaDeleteUpdate.innerHTML = "";
       
        
        

        if(idFuncionario == ''  )
        {
            alert("id vazio");
        }
        else if(ultimoIdFuncionario  < idFuncionario)
        {
            alert("Digite um id válido");
        } else{
            atualizarOpcoes.style.display = 'block';
            ipt_update.style.display = 'block';
      

        fetch("/usuarios/updateFuncionario", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                
                idUpdate: idFuncionario,
                alteracao: alteracaoFuncionario,
                updateEscolhido :  select_update,
            })
        }).then(function(resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                console.log('');
                respostaDeleteUpdate.innerHTML = "Alteração" + ipt_update.value + "do funcionário"+ idFuncionario + "realizado com sucesso";
                limparFormulario();
               // finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar a alteração!");
            }
        }).catch(function(resposta) {
            console.log(`#ERRO: ${resposta}`);
           // finalizarAguardar();
        });
    }
        return false;
    }

   
  

</script>